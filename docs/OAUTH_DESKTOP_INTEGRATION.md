# OAuth Desktop Integration Documentation

## Overview

The Love Claude Code desktop app now supports OAuth tokens generated by the Claude Code CLI. This allows users with Claude Max (Pro) subscriptions to use their OAuth tokens instead of API keys.

## How It Works

### 1. OAuth Token Detection

The desktop app automatically checks for OAuth tokens in standard locations:
- `~/.claude/oauth_token.json` - Primary location for OAuth tokens
- `~/.claude/credentials` - Alternative location

### 2. Automatic Token Usage

When executing Claude commands, the app:
1. Checks for OAuth token existence
2. Reads the token from the file system
3. Passes it to Claude CLI via `CLAUDE_CODE_OAUTH_TOKEN` environment variable
4. Claude CLI uses the token for authentication

### 3. OAuth Token Setup

Users can generate OAuth tokens using:
```bash
claude setup-token
```

This command:
- Opens a browser for Claude Max authentication
- Generates an OAuth token
- Stores it in `~/.claude/oauth_token.json`

## Implementation Details

### Electron Service Changes

1. **`checkOAuthToken()`** - Detects OAuth tokens in the file system
2. **`setupOAuthToken()`** - Runs `claude setup-token` for token generation
3. **Environment Variable Injection** - Adds `CLAUDE_CODE_OAUTH_TOKEN` to CLI commands

### IPC Handlers

New IPC handlers added:
- `claude:check-oauth` - Check OAuth token status
- `claude:setup-oauth` - Run token setup process

### Security Considerations

- OAuth tokens are stored locally in the user's home directory
- Tokens are only accessible by the Claude CLI
- No tokens are transmitted over the network by the desktop app
- Tokens are passed via environment variables (not command line arguments)

## User Flow

1. User opens Love Claude Code desktop app
2. App checks for Claude CLI installation
3. App checks for authentication:
   - First checks for OAuth token in `~/.claude` directory
   - Falls back to checking Claude CLI authentication status
4. If OAuth token exists, it's automatically used for all Claude commands
5. If no authentication, user can:
   - Run `claude setup-token` via the app
   - Or use traditional API key authentication

## Benefits

1. **Seamless Integration** - OAuth tokens work automatically when present
2. **Claude Max Support** - Pro users can use their subscription
3. **No API Key Required** - OAuth tokens eliminate need for separate API keys
4. **Automatic Detection** - No manual configuration needed

## Troubleshooting

### OAuth Token Not Working

1. Check token exists: `ls ~/.claude/oauth_token.json`
2. Verify token format: `cat ~/.claude/oauth_token.json`
3. Run `claude setup-token` to regenerate token
4. Check Claude CLI version is up to date

### Authentication Errors

If authentication fails:
1. The app will show OAuth token status in auth check
2. Error messages indicate if token is invalid or expired
3. User can regenerate token using `claude setup-token`

## Future Enhancements

1. **Token Refresh** - Automatic token refresh when expired
2. **UI Integration** - Visual OAuth setup flow in the app
3. **Token Management** - View and manage OAuth tokens from settings
4. **Multiple Accounts** - Support for switching between OAuth accounts